DATAS SEGMENT
    STUDENTSDATA DB ?,1000 DUP(?);从20位置存储学生信息，前段备用，每个学生占用30个空间
    TEMPSTUDENTDATA DB 10,?,12 DUP(?);用于缓存输入信息
    STUDENTNUM DB ?;当前学生编号，用于方便存储学生数值
    INPUTTYPE DB ?;当前输入类型，0:姓名,1:成绩,2:学号
    GOTOXYDATAX DB ?;行
    GOTOXYDATAY DB ?;列
    PRINTF1 DB '  PLEASE INPUT STUDENT S INFO.','$'
    PRINTF2 DB '  ____NAME______GRADE______NUM____','$'
	PRINTF3 DB '  CONTINUE INPUT?(y/n)','$'
	PRINTF4 DB '  l           l       l          l','$'
	PRINTF5 DB '  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~','$'
	PRINTF6 DB '  l   1.INPUT STUDENT S INFO.    l','$'
	PRINTF7 DB '  l   2.FROM BIG TO SAMLL ORDER. l','$'
	PRINTF8 DB '  l   3.FROM SAMLL TO BIG ORDER. l','$'	
	PRINTF9 DB '  l   4.ABOUT.                   l','$'
	PRINTFA DB '  l   5.EXIT.                    l','$'
	PRINTFB DB '  ________________________________','$'
	PRINTFC DB '  PLEASE CHOICE AND INPUT NUM.','$'	
	PRINTFABOUT0 DB '  STUDENT_MANAGE 1.0','$'
	PRINTFABOUT1 DB '  JKB131-XieMingZhi','$'
	PRINTFABOUT2 DB '  201307014104','$'
	PRINTFABOUT3 DB '  2015-6-20_21:20','$'
	PRINTFERROR DB '  !!!ERROR:PLEASE INPUT NUMBER','$'
	
DATAS ENDS

STACKS SEGMENT
    ;此处输入堆栈段代码
STACKS ENDS

CODES SEGMENT
    ASSUME CS:CODES,DS:DATAS,SS:STACKS
START:
    MOV AX,DATAS
    MOV DS,AX
    MOV ES,AX
    
    
    ENTERH MACRO;回车换行
    PUSH AX
    PUSH DX
	MOV AH,2
	MOV DL,0AH
	INT 21H
	MOV DL,0DH
	INT 21H
    POP DX
    POP AX
    ENDM
    
    
    DISPLAYSTR MACRO STRX;输出字符串;长度上限
    LOCAL NEXTSTR
    LOCAL NEXTSTRX
    PUSH CX
    PUSH SI
    PUSH DX
    PUSH AX
	MOV CL,STRX+1
	LEA SI,STRX+2
NEXTSTR:
	MOV DL,[SI]
	MOV DH,'$'
	CMP DH,DL
	JE NEXTSTRX
	MOV AH,2
	INT 21H
	INC SI
	DEC CL
	JNE NEXTSTR
NEXTSTRX:
	POP AX
	POP DX
	POP SI
	POP CX
	ENDM
	
	
	INPUTSTR MACRO FLASHSTR;输入字符串,用空格确定输入
	LOCAL NEXTINPSTR
	LOCAL ENDINPSTR
	LOCAL GRADELIMIT
	LOCAL INTPUERRORTEST
	LOCAL ENDINPSTRX
	PUSHAD
	MOV BH,0
	LEA SI,FLASHSTR+2
NEXTINPSTR:
	MOV AH,1
	INT 21H
	
	MOV DL,INPUTTYPE
	CMP DL,1
	JNZ INTPUERRORTEST
	TEST AL,40H
	JZ INTPUERRORTEST
	PUSH BX	
	MOV AH,03H
	MOV BH,0
	INT 10H
	PUSH DX

	MOV AH,6
	MOV AL,0
	MOV BH,0FH
	MOV CH,6
	MOV CL,10
	MOV DH,10
	MOV DL,50
	INT 10H	


	MOV GOTOXYDATAX,7
	MOV GOTOXYDATAY,12
	GOTOXY
	DISPLAYSTR PRINTFERROR
	MOV AH,1
	INT 21H

	MOV AH,6
	MOV AL,0
	MOV BH,7AH
	MOV CH,6
	MOV CL,10
	MOV DH,10
	MOV DL,50
	INT 10H	
	POP DX
	POP BX	
	DEC DL
	MOV GOTOXYDATAX,DH
	MOV GOTOXYDATAY,DL
	GOTOXY
	JMP NEXTINPSTR
	
	
	
INTPUERRORTEST:	
	MOV [SI],AL
	INC SI
	INC BH

	MOV DL,8
	CMP DL,BH
	JZ ENDINPSTRX
	
	MOV DL,INPUTTYPE
	CMP DL,1;判断是否当前为输入成绩，对输入成绩进行限制字数为3
	JNZ GRADELIMIT
	MOV DL,3
	CMP DL,BH
	JZ ENDINPSTRX

GRADELIMIT:	
	MOV DL,0DH
	CMP DL,AL
	JZ ENDINPSTR
	MOV DL,' '
	CMP DL,AL
	JNZ NEXTINPSTR
	JMP ENDINPSTR
ENDINPSTRX:
	INC BH
	INC SI

ENDINPSTR:
	MOV DL,'$'
	MOV [SI],DL
	LEA SI,FLASHSTR+1
	MOV [SI],BH
	POPAD
	ENDM
	
	GOTOXY MACRO ;置光标位置，使用GOTOXYDATAX存储行数，GOTOXYDATAY存储列数。默认为第0页
	PUSH AX
	PUSH BX
	PUSH DX
	MOV DH,GOTOXYDATAX
	MOV DL,GOTOXYDATAY
	MOV BH,0
	MOV AH,2
	INT 10H
	POP DX
	POP BX
	POP AX
	ENDM
	
	
	INPUTSTUDENTSINFO MACRO;学生信息输入
	LOCAL NEXTINPUTS
	LOCAL GOTOXTINPUTX
	LOCAL GOTOXTINPUTY
	LOCAL GOTOXTINPUTZ
	PUSHAD
	MOV DX,0
	MOV AH,0
	MOV CH,0
NEXTINPUTS:
	MOV GOTOXYDATAX,2
	CMP DL,0
	JNZ GOTOXTINPUTX
	MOV GOTOXYDATAY,2
	JMP GOTOXTINPUTZ
GOTOXTINPUTX:
	CMP DL,10
	JNZ GOTOXTINPUTY
	MOV GOTOXYDATAY,14
	JMP GOTOXTINPUTZ
GOTOXTINPUTY:
	MOV GOTOXYDATAY,22
GOTOXTINPUTZ:
	GOTOXY
	INPUTSTR TEMPSTUDENTDATA
	LEA SI,TEMPSTUDENTDATA
	LEA DI,STUDENTSDATA
	MOV CL,[SI+1]
	INC CL
	MOV AL,STUDENTNUM
	MOV BL,30
	MUL BL
	ADD DI,AX
	ADD	DI,20
	ADD DI,DX
	CLD
	REP MOVSB
	MOV CL,'$'
	MOV [DI],CL
	INC INPUTTYPE
	ADD DX,10
	CMP DX,30
	JNZ NEXTINPUTS
	MOV INPUTTYPE,0
	POPAD
	ENDM

	PRINTFSTUDENTSINFO MACRO;学生信息输出
	LOCAL NEXTPRINTFSTE
	LOCAL NEXTPRINTFSTEX
	LOCAL GOTOXTPRINTFX
	LOCAL GOTOXTPRINTFY
	LOCAL GOTOXTPRINTFZ
	PUSHAD	
	MOV CH,0
	MOV BH,0
	MOV GOTOXYDATAX,0
	MOV GOTOXYDATAY,0
	GOTOXY
	CLEAR
	ENTERH
	DISPLAYSTR PRINTF2
NEXTPRINTFSTEX:
	ADD GOTOXYDATAX,2
	ENTERH
	DISPLAYSTR PRINTF4
	MOV DX,0
NEXTPRINTFSTE:	
	LEA SI,STUDENTSDATA
	LEA DI,TEMPSTUDENTDATA
	MOV AL,BH
	MOV AH,0
	MOV BL,30
	MUL BL
	ADD SI,AX
	ADD SI,20
	ADD SI,DX
	MOV CL,[SI+1]
	INC CL
	CLD
	REP MOVSB
	MOV CL,'$'
	MOV [DI],CL
	CMP DL,0
	JNZ GOTOXTPRINTFX
	MOV GOTOXYDATAY,2
	JMP GOTOXTPRINTFZ
GOTOXTPRINTFX:
	CMP DL,10
	JNZ GOTOXTPRINTFY
	MOV GOTOXYDATAY,14
	JMP GOTOXTPRINTFZ
GOTOXTPRINTFY:
	MOV GOTOXYDATAY,22
GOTOXTPRINTFZ:
	GOTOXY
	DISPLAYSTR TEMPSTUDENTDATA
	ENTERH
	DISPLAYSTR PRINTF5	
	ADD DL,10
	CMP DL,30
	JNE NEXTPRINTFSTE
		
	INC BH
	MOV DL,STUDENTNUM
	CMP BH,DL
	JNZ NEXTPRINTFSTEX	
	MOV AH,1
	INT 21H
	POPAD
	ENDM
	

	CLEAR MACRO;清屏,并设置白(灰)底，高亮绿色
	PUSH AX
	PUSH BX
	PUSH CX
	PUSH DX
	MOV AH,6
	MOV AL,0
	MOV BH,7AH
	MOV CH,0
	MOV CL,0
	MOV DH,24
	MOV DL,79
	INT 10H
	POP DX
	POP CX
	POP BX
	POP AX
	ENDM
	
	
	STUDENTSSORT1 MACRO JCX,JCY,JCZ ;排序小部件；SI/DI;CL/CH;DL;DH
	PUSH BX
	MOV AL,JCY
	MOV BL,30
	MUL BL
	ADD JCX,AX
	ADD JCX,30
	MOV JCZ,[JCX+1]
	DEC JCZ
	POP BX
	ENDM
	
	
	STUDENTSSORT MACRO JXXX,JYYY;排序,冒泡
	LOCAL NEXTSSORTX
	LOCAL NEXTSSORTY
	LOCAL NEXTSSORTZ
	LOCAL NEXTSSORTV
	LOCAL NEXTSSORTM
	PUSHAD
	MOV CX,0
NEXTSSORTM:
	LEA SI,STUDENTSDATA
	MOV DI,SI	
	MOV BH,0
	MOV AH,0		
	STUDENTSSORT1 SI,CL,DL
	STUDENTSSORT1 DI,CH,DH
	CMP DL,DH
	JXXX NEXTSSORTX
	JYYY NEXTSSORTY	
	MOV BL,2
NEXTSSORTZ:
	MOV AL,[SI+BX]
	MOV AH,[DI+BX]
	CMP AL,AH
	JXXX NEXTSSORTX
	JYYY NEXTSSORTY
	INC BL
	CMP BL,5
	JNZ NEXTSSORTZ
NEXTSSORTY:
	MOV BL,0
	SUB SI,10
	SUB DI,10
NEXTSSORTV:	
	MOV AL,[DI+BX]
	MOV AH,[SI+BX]
	MOV [SI+BX],AL
	MOV [DI+BX],AH
	INC BL
	CMP BL,30
	JNE NEXTSSORTV
	ADD SI,10
	ADD DI,10
NEXTSSORTX:
	INC CH
	MOV BL,STUDENTNUM
	CMP CH,BL
	JL NEXTSSORTM
	INC CL
	MOV CH,CL
	CMP CL,BL
	JL NEXTSSORTM
	POPAD
	ENDM

	
	PRINTFSTUDENTINFOMENU MACRO;学生成绩输入菜单
	PUSH AX
NEXTPSTUMENU:
	MOV GOTOXYDATAX,0
	MOV GOTOXYDATAY,0
	GOTOXY
	CLEAR
	DISPLAYSTR PRINTF1
	ENTERH
	DISPLAYSTR PRINTF2
	ENTERH
	DISPLAYSTR PRINTF4
	ENTERH
	DISPLAYSTR PRINTF5
	INPUTSTUDENTSINFO
	INC STUDENTNUM
	MOV GOTOXYDATAX,4
	MOV GOTOXYDATAY,3
	GOTOXY
	DISPLAYSTR PRINTF3
	MOV AH,1
	INT 21H
	CMP AL,'Y'
	JZ NEXTPSTUMENU
	CMP AL,'y'
	JZ NEXTPSTUMENU
	POP AX
	ENDM
	
	
	MAINMENU MACRO
	MOV GOTOXYDATAX,0
	MOV GOTOXYDATAY,0
	GOTOXY
	CLEAR
	DISPLAYSTR PRINTFB
	ENTERH
	DISPLAYSTR PRINTF6
	ENTERH
	DISPLAYSTR PRINTF7
	ENTERH
	DISPLAYSTR PRINTF8
	ENTERH
	DISPLAYSTR PRINTF9
	ENTERH
	DISPLAYSTR PRINTFA
	ENTERH
	DISPLAYSTR PRINTF5
	ENTERH
	ENDM
	
	ABOUTINFO MACRO;版本信息
	MOV AH,6
	MOV AL,0
	MOV BH,0FH
	MOV CH,5
	MOV CL,10
	MOV DH,12
	MOV DL,50
	INT 10H	
	MOV GOTOXYDATAX,6
	MOV GOTOXYDATAY,11
	GOTOXY 
	DISPLAYSTR PRINTFABOUT0
	MOV GOTOXYDATAX,7
	MOV GOTOXYDATAY,11
	GOTOXY 
	DISPLAYSTR PRINTFABOUT1
	MOV GOTOXYDATAX,8
	MOV GOTOXYDATAY,11
	GOTOXY 
	DISPLAYSTR PRINTFABOUT2
	MOV GOTOXYDATAX,9
	MOV GOTOXYDATAY,11
	GOTOXY 
	DISPLAYSTR PRINTFABOUT3
	MOV AH,1
	INT 21H
	ENDM
	

    
	MAINCHOICE MACRO;主菜单选择
MAINMENUCV:
	MOV AX,0
	MAINMENU
	DISPLAYSTR PRINTFC
	MOV AH,1
	INT 21H
	CMP AL,31H
	JNZ MAINMENUCX
	PRINTFSTUDENTINFOMENU
	JMP MAINMENUCV
MAINMENUCX:
	CMP AL,32H
	JNZ MAINMENUCY
	MOV BL,STUDENTNUM
	CMP BL,0
	JZ MAINMENUCV
	STUDENTSSORT JG,JL
	PRINTFSTUDENTSINFO
	JMP MAINMENUCV
MAINMENUCY:
	CMP AL,33H
	JNZ MAINMENUCZ
	MOV BL,STUDENTNUM
	CMP BL,0
	JZ MAINMENUCV
	STUDENTSSORT JL,JG
	PRINTFSTUDENTSINFO
	JMP MAINMENUCV
MAINMENUCZ:
	CMP AL,34H
	JNZ MAINMENUCM
	ABOUTINFO
	JMP MAINMENUCV
MAINMENUCM:
	CMP AL,35H
	JNZ MAINMENUCV
	ENDM

	MOV STUDENTNUM,0
	MOV INPUTTYPE,0	
	MAINCHOICE

    MOV AH,4CH
    INT 21H
CODES ENDS
    END START
